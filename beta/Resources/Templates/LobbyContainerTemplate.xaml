<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:models="clr-namespace:beta.Models.Server"
                    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                    mc:Ignorable="d"
                    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
                    xmlns:ui="http://schemas.modernwpf.com/2019">
    <Style x:Key="LobbyTextBlockStyle" TargetType="TextBlock">
        <Setter Property="Padding" Value="24 0 0 0"/>
        <Setter Property="FontSize" Value="13"/>
        <Setter Property="Foreground" Value="{DynamicResource SystemControlBackgroundBaseMediumHighBrush}"/>
        <Setter Property="Margin" Value="0 6 0 0"/>
    </Style>
    <Style x:Key="NewLobbyBorderStyle" TargetType="Border">
        <Setter Property="Visibility" Value="Collapsed"/>
        <Style.Triggers>
            <DataTrigger Binding="{Binding LobbyState}" Value="1">
                <Setter Property="Visibility" Value="Visible"/>
            </DataTrigger>

            <!--is not used currently-->
            
            <!--<DataTrigger Binding="{Binding LobbyState}" Value="-1">
                <Setter Property="Visibility" Value="Visible"/>
                <Setter Property="TextBlock.Foreground" Value="Red"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding LobbyState}" Value="2">
                <Setter Property="Visibility" Value="Visible"/>
                <Setter Property="TextBlock.Foreground" Value="Orange"/>
            </DataTrigger>-->
        </Style.Triggers>
    </Style>

    <Style x:Key="PreviewImageStyle" TargetType="Image">
        <Style.Triggers>
            <DataTrigger Binding="{Binding PreviewType}" Value="0">
                <Setter Property="Width" Value="90"/>
            </DataTrigger>
        </Style.Triggers>
    </Style>
    <Style x:Key="Border" TargetType="Border">
        <Setter Property="Background" Value="{DynamicResource NavigationViewDefaultPaneBackground}"/>
        <Style.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background" Value="{DynamicResource SystemControlPageBackgroundChromeMediumLowBrush}"/>
                <Setter Property="Panel.ZIndex" Value="3"/>
            </Trigger>
        </Style.Triggers>
    </Style>
    <DataTemplate x:Key="PlayerCard" d:DataType="{x:Type models:PlayerInfoMessage}">
        <Grid DataContext="{Binding Converter={StaticResource GetPlayerInfoConverter}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Image Source="{Binding Flag}"/>
            <TextBlock
                Text="{Binding login}"
                Grid.Column="1"/>
            <Grid 
                DataContext="{Binding ratings[global], Mode=OneWay}"
                Margin="10 0"
                Grid.Column="2"
                HorizontalAlignment="Right">
                <TextBlock Text="{Binding DisplayedRating, Mode=OneWay}"/>
            </Grid>
        </Grid>
    </DataTemplate>

    <ItemContainerTemplate x:Key="LobbyContainerDefaultTemplate">
        <Border 
            Opacity="1"
            Name="Test"
            VerticalAlignment="Bottom"
            Padding="0"
            CornerRadius="4"
            d:DataContext="{d:DesignInstance {x:Type models:GameInfoMessage}}"
            Style="{StaticResource Border}">
            <Grid>
                <StackPanel>
                    <ui:ListViewHeaderItem
                        Content="{Binding title}"
                        Margin="-3 0 -3 4"
                        FontSize="14"
                        Foreground="{DynamicResource SystemControlBackgroundBaseMediumHighBrush}"
                        ToolTip="Title"
                        FontWeight="SemiBold"/>
                    <StackPanel
                        Grid.Row="1"
                        Orientation="Horizontal"
                        Background="Transparent"
                        Margin="10 0 0 10">
                        <Grid Width="90" Height="90">
                            <Border CornerRadius="4" SnapsToDevicePixels="True">
                                <Border.Background>
                                    <VisualBrush Stretch="None">
                                        <VisualBrush.Visual>
                                            <Image
                                                Source="{Binding MapNameType,Converter={StaticResource GetMapPreviewConverter}}"
                                                Style="{StaticResource PreviewImageStyle}"/>
                                        </VisualBrush.Visual>
                                    </VisualBrush>
                                </Border.Background>
                            </Border>
                        </Grid>
                        <StackPanel Orientation="Vertical"
                                Margin="8 0 8 0">
                            <TextBlock Style="{StaticResource LobbyTextBlockStyle}"
                                    Margin="0"
                                    ToolTip="Host"
                                    Text="{Binding host}">
                                <TextBlock.Background>
                                    <ImageBrush Stretch="Uniform"  AlignmentX="Left" ImageSource="{DynamicResource HostIcon}">
                                        <ImageBrush.Transform>
                                            <TranslateTransform X="5"/>
                                        </ImageBrush.Transform>
                                    </ImageBrush>
                                </TextBlock.Background>
                            </TextBlock>
                            <TextBlock Style="{StaticResource LobbyTextBlockStyle}">
                                        <Run Text="{Binding num_players}"/>
                                        <Run Text="/" FontSize="12"/>
                                        <Run Text="{Binding max_players}"/>
                                <TextBlock.Background>
                                    <ImageBrush Stretch="Uniform" AlignmentX="Left" ImageSource="{DynamicResource PlayersIcon}">
                                        <ImageBrush.Transform>
                                            <TransformGroup>
                                                <TranslateTransform X="1" Y="1"/>
                                                <ScaleTransform ScaleX=".9" ScaleY=".9"/>
                                            </TransformGroup>
                                        </ImageBrush.Transform>
                                    </ImageBrush>
                                </TextBlock.Background>
                                <TextBlock.ToolTip>
                                    <StackPanel>
                                        <ItemsControl ItemsSource="{Binding teams}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <StackPanel Orientation="Horizontal"/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel>
                                                        <TextBlock
                                                            Text="{Binding Key, Mode=OneWay}"
                                                            IsHitTestVisible="False"/>
                                                        <ItemsControl
                                                            ItemsSource="{Binding Value}"
                                                            ItemTemplate="{StaticResource PlayerCard}"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </TextBlock.ToolTip>
                                    </TextBlock>
                            <TextBlock Style="{StaticResource LobbyTextBlockStyle}"
                                    ToolTip="Map"
                                    Text="{Binding MapName}">
                                <TextBlock.Background>
                                    <ImageBrush Stretch="Uniform" AlignmentX="Left" ImageSource="{DynamicResource MapIcon}">
                                        <ImageBrush.Transform>
                                            <TransformGroup>
                                                <TranslateTransform X="3" Y="1"/>
                                                <ScaleTransform ScaleX=".95" ScaleY=".95"/>
                                            </TransformGroup>
                                        </ImageBrush.Transform>
                                    </ImageBrush>
                                </TextBlock.Background>
                            </TextBlock>
                            <TextBlock ToolTip="Secured with password" Text="Secured">
                                <TextBlock.Resources>
                                    <Style TargetType="TextBlock" BasedOn="{StaticResource LobbyTextBlockStyle}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding password_protected}"
                                                        Value="True">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <ImageBrush Stretch="Uniform"
                                                                AlignmentX="Left"
                                                                ImageSource="{DynamicResource SecuredIcon}">
                                                            <ImageBrush.Transform>
                                                                <TransformGroup>
                                                                    <TranslateTransform X="4" Y="2"/>
                                                                    <ScaleTransform ScaleX=".8" ScaleY=".8"/>
                                                                </TransformGroup>
                                                            </ImageBrush.Transform>
                                                        </ImageBrush>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Resources>
                            </TextBlock>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
                <!--<Border HorizontalAlignment="Right"
                        VerticalAlignment="Top" Style="{StaticResource NewLobbyBorderStyle}" 
                        Margin="13 10"
                        Padding="6 3"
                        CornerRadius="4">
                    <Border.Background>
                        <SolidColorBrush Color="Black" Opacity=".2"/>
                    </Border.Background>
                    <TextBlock
                        Text="{Binding LobbyState, UpdateSourceTrigger=PropertyChanged}"
                        FontSize="13"
                        Margin="0 0 0 2"
                        FontWeight="SemiBold"
                        Foreground="RoyalBlue"/>
                </Border>-->
                <Canvas HorizontalAlignment="Left"
                        VerticalAlignment="Bottom">
                    <StackPanel
                        Width="{Binding ElementName=Test, Path=ActualWidth}"
                        Background="{Binding ElementName=Test, Path=Background}">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ElementName=Test, Path=IsMouseOver}"
                                                 Value="True">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <ToggleButton x:Name="ShowPlayerToggleBtn" Padding="4 4 8 4"
                                      Margin="10">
                            <ToggleButton.Content>
                                <TextBlock
                                    Text="Show players"
                                    Padding="28 0 0 0">
                                    <TextBlock.Background>
                                        <VisualBrush Stretch="Uniform"
                                                     AlignmentX="Left">
                                            <VisualBrush.Visual>
                                                <Image Source="{StaticResource PlayersIcon}"/>
                                            </VisualBrush.Visual>
                                        </VisualBrush>
                                    </TextBlock.Background>
                                </TextBlock>
                            </ToggleButton.Content>
                        </ToggleButton>
                        <ItemsControl ItemsSource="{Binding teams}"
                                      Margin="10">
                            <ItemsControl.Style>
                                <Style TargetType="ItemsControl">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ElementName=ShowPlayerToggleBtn, Path=IsChecked}"
                                                     Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.Style>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <TextBlock Text="{Binding Key, Mode=OneWay}"/>
                                        <ItemsControl
                                            ItemsSource="{Binding Value}"
                                            ItemTemplate="{StaticResource PlayerCard}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <!--<ui:ItemsRepeater ItemsSource="{Binding teams}"
                                          Margin="10">
                            <ui:ItemsRepeater.Layout>
                                <ui:UniformGridLayout
                                    ItemsJustification="SpaceBetween"
                                    MinColumnSpacing="10"
                                    MinRowSpacing="10"/>
                            </ui:ItemsRepeater.Layout>
                            <ui:ItemsRepeater.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <TextBlock Text="{Binding Key, Mode=OneWay}"/>
                                        <ItemsControl
                                            ItemsSource="{Binding Value}"
                                            ItemTemplate="{StaticResource PlayerCard}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ui:ItemsRepeater.ItemTemplate>
                        </ui:ItemsRepeater>-->
                    </StackPanel>
                </Canvas>
            </Grid>
        </Border>
    </ItemContainerTemplate>
</ResourceDictionary>